---
slug: create-charge
layout_name: ''
authorization_policies:
---

{% query_graph 'modules/payments/get_customer_by_email', result_name: "g_customer", email: "test@exampe.com" %}

{% assign customer_id =  g_customer.results.first.id | append: '' %}
{% query_graph 'modules/payments/get_credit_cards_by_customer_id', result_name: 'g_cards', customer_id: customer_id %}

{% assign credit_card = g_cards.customizations.results.last %}
{%- parse_json 'data' -%}
  {

    "credit_card_id": "{{ credit_card.id }}",
    "currency": "USD",
    "description": "My First Charge",
    "statement_descriptor": "Statement description",
    "capture": "true",
    "customer_id": "{{ g_customer.results.first.gateway_id }}",
    "destination": "",
    "transfer_group": "",
    "amount_cents": "300",
    "application_fee_cents": "0"
  }
{%- endparse_json -%}

{%-
  include_form 'modules/payments/gateway_request_form',
  gateway: 'stripe'
  request_type: 'create_charge'
  redirect_to: '/create-charge'
  data: data
%}


