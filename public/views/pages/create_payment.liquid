---
slug: create-payment
layout_name: ''
authorization_policies:
---
{% query_graph 'modules/payments/get_customer_by_email', result_name: "g_customer", email: "test@exampe.com" %}

{% assign customer =  g_customer.customizations.results.first %}
{% assign customer_id =  customer.id | append: '' %}

{% query_graph 'modules/payments/get_credit_cards_by_customer_id', result_name: 'g_cards', customer_id: customer_id %}

{% assign credit_card = g_cards.customizations.results.last %}
{%- parse_json 'data' -%}
  {
    "credit_card_id": "{{ credit_card.id | append: ''}}",
    "currency": "CAD",
    "description": "My First Payment",
    "statement_descriptor": "Statement description",
    "capture": "true",
    "customer": "{{ customer.gateway_id }}",
    "customer_id": "{{ customer.gateway_id }}",
    "source": "{{ credit_card.properties.gateway_id }}",
    "destination": "",
    "transfer_group": "",
    "amount": "300",
    "metadata": ""
  }
{%- endparse_json -%}

{%-
  include_form 'modules/payments/gateway_request_form',
  gateway: 'stripe'
  request_type: 'create_payment'
  redirect_to: '/create-payment'
  data: data
%}


