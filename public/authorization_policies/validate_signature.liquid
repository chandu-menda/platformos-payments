---
name: validate_signature
redirect_to: "/unauthorized"
---
{%- capture "signature" -%}
  {% include 'modules/payments/shared/calculate_signature', properties: context.params.form.properties_attributes, expires_in: context.params.expires_in, redirect_to: context.params.redirect_to %}
{%- endcapture -%}
{% assign expires_in = context.params.expires_in | to_time %}
{% assign now = "now" | to_time %}
{% assign expires_in_minus_now = now | time_diff: expires_in %}
{% log expires_in_minus_now, type:"expires in min" %}
{% log signature, type:"signature" %}
{% log context.params.signature, type:"params signature" %}
{% log context.params.form.properties_attributes, type:"properties" %}
{% if context.params.signature == signature and expires_in_minus_now > 0 %}true{% endif %}
